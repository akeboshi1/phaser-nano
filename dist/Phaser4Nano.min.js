!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Phaser4Nano=e()}(this,(function(){"use strict";function t(t){return class extends t{constructor(){super(...arguments),this._alpha=1}setAlpha(t=1){return t!==this._alpha&&(this._alpha=t,this.setDirty()),this}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.setDirty())}}}function e(t){return class extends t{constructor(...t){super(t),this.anims=new Map,this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}addAnimation(t,e){return this.anims.has(t)||this.anims.set(t,this.texture.getFrames(e)),this}addAnimationFromAtlas(t,e,i,r,s=0,n=""){return this.anims.has(t)||this.anims.set(t,this.texture.getFramesInRange(e,i,r,s,n)),this}removeAnimation(t){return this.anims.delete(t),this}clearAnimations(){return this.anims.clear(),this}play(t,e={}){const{speed:i=24,repeat:r=0,yoyo:s=!1,startFrame:n=0,delay:a=0,repeatDelay:o=0,onStart:h=null,onRepeat:u=null,onComplete:c=null,forceRestart:l=!1}=e,d=this.animData;if(d.isPlaying)if(d.currentAnim!==t)this.stop();else if(!l)return this;return this.anims.has(t)&&(d.currentFrames=this.anims.get(t),d.currentAnim=t,d.frameIndex=n,d.animSpeed=1e3/i,d.nextFrameTime=d.animSpeed+a,d.isPlaying=!0,d.playingForward=!0,d.yoyo=s,d.repeatCount=r,d.delay=a,d.repeatDelay=o,d.onStart=h,d.onRepeat=u,d.onComplete=c,0===a?(this.setFrame(d.currentFrames[d.frameIndex]),h&&h(this,t)):d.pendingStart=!0),this}stop(){const t=this.animData;return t.isPlaying=!1,t.currentAnim="",t.onComplete&&t.onComplete(this,t.currentAnim),this}nextFrame(){const t=this.animData;if(t.frameIndex++,t.frameIndex===t.currentFrames.length)if(t.yoyo)t.frameIndex--,t.playingForward=!1;else{if(!(-1===t.repeatCount||t.repeatCount>0))return t.frameIndex--,this.stop();t.frameIndex=0,-1!==t.repeatCount&&t.repeatCount--,t.onRepeat&&t.onRepeat(this,t.currentAnim),t.nextFrameTime+=t.repeatDelay}return this.setFrame(t.currentFrames[t.frameIndex]),t.nextFrameTime+=t.animSpeed,this}prevFrame(){const t=this.animData;if(t.frameIndex--,-1===t.frameIndex){if(!(-1===t.repeatCount||t.repeatCount>0))return t.frameIndex=0,this.stop();t.frameIndex=0,t.playingForward=!0,-1!==t.repeatCount&&t.repeatCount--,t.onRepeat&&t.onRepeat(this,t.currentAnim),t.nextFrameTime+=t.repeatDelay}return this.setFrame(t.currentFrames[t.frameIndex]),t.nextFrameTime+=t.animSpeed,this}update(t,e){super.update(t,e);const i=this.animData;i.isPlaying&&(i.nextFrameTime-=1e3*t,i.nextFrameTime=Math.max(i.nextFrameTime,0),0===i.nextFrameTime&&(i.pendingStart?(i.onStart&&i.onStart(this,i.currentAnim),i.pendingStart=!1,i.nextFrameTime=i.animSpeed):i.playingForward?this.nextFrame():this.prevFrame()))}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}}}function i(t){return class extends t{constructor(...t){super(t),this.children=[],this.isParent=!0}getChildren(){return this.children}addChild(...t){return t.forEach(t=>{this.addChildAt(t,this.children.length)}),this}addChildAt(t,e){return e>=0&&e<=this.children.length&&(t.parent&&t.parent.removeChild(t),t.setParent(this),this.children.splice(e,0,t),t.updateTransform()),t}swapChildren(t,e){if(t===e)return this;const i=this.getChildIndex(t),r=this.getChildIndex(e);if(i<0||r<0)throw new Error("swap: Both children must belong to the same parent");return this.children[i]=e,this.children[r]=t,this}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("Supplied DisplayObject not child of the caller");return e}setChildIndex(t,e){const i=this.children;if(e<0||e>=i.length)throw new Error("Index "+e+" out of bounds");const r=this.getChildIndex(t);return i.splice(r,1),i.splice(e,0,t),this}getChildAt(t){if(t<0||t>=this.numChildren)throw new Error("Index "+t+" out of bounds");return this.children[t]}removeChild(t){const e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)}removeChildAt(t){const e=this.getChildAt(t);return e&&(e.parent=void 0,e.updateTransform(),this.children.splice(t,1)),e}removeChildren(t=0,e){const i=this.children;void 0===e&&(e=i.length);const r=e-t;if(r>0&&r<=e){const e=i.splice(t,r);return e.forEach(t=>{t.parent=void 0,t.updateTransform()}),e}if(0===r&&0===i.length)return[];throw new Error("Range Error. Values out of bounds")}update(t,e){const i=this.children;for(let r=0;r<i.length;r++)i[r].update(t,e)}get numChildren(){return this.children.length}}}function r(t){return class extends t{constructor(){super(...arguments),this.dirty=!0,this.dirtyFrame=0}setDirty(t=!0){return this.dirty=!0,t&&(this.dirtyFrame=this.scene.game.frame),this}}}class s{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}zero(){return this.set()}getArray(){return[this.x,this.y]}fromArray(t){return this.set(t[0],t[1])}[Symbol.iterator](){return this.getArray()[Symbol.iterator]()}}function n(t){return class extends t{constructor(){super(...arguments),this._origin=new s(.5,.5)}setOrigin(t,e=t){return this._origin.set(t,e),this}get originX(){return this._origin.x}set originX(t){this._origin.x=t}get originY(){return this._origin.y}set originY(t){this._origin.y=t}}}function a(t){return class extends t{constructor(){super(...arguments),this.isParent=!1}setParent(t){return this.parent=t,this}update(t,e){}}}function o(t){return class extends t{constructor(){super(...arguments),this._position=new s}setPosition(t,e=t){return this._position.set(t,e),this.updateTransform()}set x(t){this._position.x=t,this.updateTransform()}get x(){return this._position.x}set y(t){this._position.y=t,this.updateTransform()}get y(){return this._position.y}}}function h(t){return class extends t{constructor(...t){super(t),this._alpha=1,this.vertexAlpha=new Float32Array(4).fill(1)}setAlpha(t=1,e=t,i=t,r=t){const s=this.vertexAlpha;return s[0]=t,s[1]=e,s[2]=i,s[3]=r,this.packColors()}get alpha(){return this._alpha}set alpha(t){this._alpha=t,this.setAlpha(t)}}}function u(t){return class extends t{constructor(...t){super(t),this._tint=16777215,this.vertexTint=new Uint32Array(4).fill(16777215)}setTint(t=16777215,e=t,i=t,r=t){const s=this.vertexTint;return s[0]=t,s[1]=e,s[2]=i,s[3]=r,this.packColors()}get tint(){return this._tint}set tint(t){this._tint=t,this.setTint(t)}}}function c(t){return class extends t{constructor(){super(...arguments),this.renderable=!0}setRenderable(t){return this.renderable=t,this}willRender(){return this.visible&&this.renderable&&this.alpha>0&&this.hasTexture}}}function l(t){return class extends t{constructor(){super(...arguments),this._rotation=0}setRotation(t){return t!==this._rotation&&(this._rotation=t,this.updateCache()),this}set rotation(t){t!==this._rotation&&(this._rotation=t,this.updateCache())}get rotation(){return this._rotation}}}function d(t){return class extends t{constructor(){super(...arguments),this._scale=new s(1,1)}setScale(t,e=t){return this._scale.set(t,e),this.updateCache()}set scaleX(t){t!==this._scale.x&&(this._scale.x=t,this.updateCache())}get scaleX(){return this._scale.x}set scaleY(t){t!==this._scale.y&&(this._scale.y=t,this.updateCache())}get scaleY(){return this._scale.y}}}function p(t){return class extends t{setScene(t){return this.scene=t,this}}}function m(t){return class extends t{setSize(t,e){return this.width=t,this.height=e,this}}}function x(t){return class extends t{constructor(){super(...arguments),this._skew=new s(0,0)}setSkew(t,e=t){return this._skew.set(t,e),this.updateCache()}set skewX(t){t!==this._skew.x&&(this._skew.x=t,this.updateCache())}get skewX(){return this._skew.x}set skewY(t){t!==this._skew.y&&(this._skew.y=t,this.updateCache())}get skewY(){return this._skew.y}}}class f{constructor(t,e,i,r,s,n){this.trimmed=!1,this.texture=t,this.key=e,this.x=i,this.y=r,this.width=s,this.height=n,this.sourceSizeWidth=s,this.sourceSizeHeight=n,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,i,r,s,n){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=i,this.spriteSourceSizeY=r,this.spriteSourceSizeWidth=s,this.spriteSourceSizeHeight=n}updateUVs(){const{x:t,y:e,width:i,height:r}=this,s=this.texture.width,n=this.texture.height;this.u0=t/s,this.v0=e/n,this.u1=(t+i)/s,this.v1=(e+r)/n}}class g{constructor(t,e){this.glIndex=0,this.glIndexCounter=-1,this.key=t,this.image=e,this.width=e.width,this.height=e.height,this.frames=new Map,this.add("__BASE",0,0,e.width,e.height)}add(t,e,i,r,s){if(this.frames.has(t))return null;let n=new f(this,t,e,i,r,s);return this.frames.set(t,n),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=n),n}get(t){if(!t)return this.firstFrame;t instanceof f&&(t=t.key);let e=this.frames.get(t);return e||(console.warn("Texture.frame missing: "+t),e=this.firstFrame),e}getFrames(t){const e=[];return t.forEach(t=>{e.push(this.get(t))}),e}getFramesInRange(t,e,i,r=0,s=""){const n=[],a=e<i?1:-1;i+=a;for(let o=e;o!==i;o+=a)n.push(t+o.toString().padStart(r,"0")+s);return this.getFrames(n)}}function T(t){return class extends t{constructor(){super(...arguments),this.hasTexture=!1,this._prevTextureID=-1}setTexture(t,e){return this.texture=t instanceof g?t:this.scene.textures.get(t),this.texture?this.setFrame(e):console.warn("Invalid Texture key: "+t),this}setFrame(t){const e=this.texture.get(t);if(e===this.frame)return this;this.frame=e,this.setSize(e.sourceSizeWidth,e.sourceSizeHeight),e.pivot&&this.setOrigin(e.pivot.x,e.pivot.y);const i=this.vertexData;return i[2]=e.u0,i[3]=e.v0,i[8]=e.u0,i[9]=e.v1,i[14]=e.u1,i[15]=e.v1,i[20]=e.u1,i[21]=e.v0,this.setDirty(),this.hasTexture=!0,this}}}function y(t,e,i,r=new s){const{a:n,b:a,c:o,d:h,tx:u,ty:c}=t;return r.x=n*e+o*i+u,r.y=a*e+h*i+c,r}function A(t,e,i,r=new s){const{a:n,b:a,c:o,d:h,tx:u,ty:c}=t,l=1/(n*h+o*-a);return r.x=h*l*e+-o*l*i+(c*o-u*h)*l,r.y=n*l*i+-a*l*e+(-c*n+u*a)*l,r}function v(t){return class extends t{constructor(...t){super(t),this.localTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this.worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0}}updateCache(){const t=this.localTransform,{rotation:e,skewX:i,skewY:r,scaleX:s,scaleY:n}=this;return t.a=Math.cos(e+r)*s,t.b=Math.sin(e+r)*s,t.c=-Math.sin(e-i)*n,t.d=Math.cos(e-i)*n,this.updateTransform()}updateTransform(){this.setDirty();const t=this.parent,e=this.localTransform,i=this.worldTransform;if(e.tx=this.x,e.ty=this.y,!t)return i.a=e.a,i.b=e.b,i.c=e.c,i.d=e.d,i.tx=e.tx,i.ty=e.ty,this;const r=t.worldTransform;let{a:s,b:n,c:a,d:o,tx:h,ty:u}=e;return i.a=s*r.a+n*r.c,i.b=s*r.b+n*r.d,i.c=a*r.a+o*r.c,i.d=a*r.b+o*r.d,i.tx=h*r.a+u*r.c+r.tx,i.ty=h*r.b+u*r.d+r.ty,this}localToGlobal(t,e,i=new s){return y(this.worldTransform,t,e,i)}globalToLocal(t,e,i=new s){return A(this.worldTransform,t,e,i)}}}function S(t){return class extends t{constructor(){super(...arguments),this.visible=!0}setVisible(t){return this.visible=t,this}}}var w=Object.freeze({__proto__:null,AlphaComponent:t,AnimationComponent:e,ContainerComponent:i,DirtyComponent:r,InputComponent:function(t){return class extends t{constructor(){super(...arguments),this.inputEnabled=!1,this.inputEnabledChildren=!0}setInteractive(t){return this.inputEnabled=!0,this.inputHitArea=t,this.inputEnabledChildren=!0,this}}},OriginComponent:n,ParentComponent:a,PositionComponent:o,QuadAlphaComponent:h,QuadTintComponent:u,RenderableComponent:c,RotationComponent:l,ScaleComponent:d,SceneComponent:p,SizeComponent:m,SkewComponent:x,TextureComponent:T,TransformComponent:v,VisibleComponent:S});function C(t,e){let i=t;return e.forEach(t=>{i=t(i)}),i}class E extends(C(class{},[t,r,a,n,o,c,l,d,p,m,x,v,S])){constructor(t,e=0,i=0){super(),this.scene=t,this._position.set(e,i),this.dirty=!0}}function b(t,e){return((255&(255*e|0))<<24|t)>>>0}class _ extends(C(E,[i,h,u,T])){constructor(t,e,i,r,s){super(),this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.setScene(t),this.setTexture(r,s),this.setPosition(e,i)}packColors(){const t=this.vertexAlpha,e=this.vertexTint,i=this.vertexColor;return i[0]=b(e[0],t[0]),i[1]=b(e[1],t[1]),i[2]=b(e[2],t[2]),i[3]=b(e[3],t[3]),this.setDirty(),this}updateVertices(t,e,i){const r=this.vertexData;if(this.dirty){this.dirty=!1;const t=this.frame,e=this._origin;let i,s,n,a;const{a:o,b:h,c:u,d:c,tx:l,ty:d}=this.worldTransform;t.trimmed?(s=t.spriteSourceSizeX-e.x*t.sourceSizeWidth,i=s+t.spriteSourceSizeWidth,a=t.spriteSourceSizeY-e.y*t.sourceSizeHeight,n=a+t.spriteSourceSizeHeight):(s=-e.x*t.sourceSizeWidth,i=s+t.sourceSizeWidth,a=-e.y*t.sourceSizeHeight,n=a+t.sourceSizeHeight),r[0]=s*o+a*u+l,r[1]=s*h+a*c+d,r[6]=s*o+n*u+l,r[7]=s*h+n*c+d,r[12]=i*o+n*u+l,r[13]=i*h+n*c+d,r[18]=i*o+a*u+l,r[19]=i*h+a*c+d}const s=this.texture.glIndex;s!==this._prevTextureID&&(this._prevTextureID=s,r[4]=s,r[10]=s,r[16]=s,r[22]=s),t.set(r,i);const n=this.vertexColor;e[i+5]=n[0],e[i+11]=n[2],e[i+17]=n[3],e[i+23]=n[1]}}class R extends(C(_,[e])){constructor(t,e,i,r,s){super(),this.setScene(t),this.setTexture(r,s),this.setPosition(e,i)}}class F extends E{constructor(t,e=0,i=0){super(t,e,i),this.renderer=t.game.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.setSize(this.renderer.width,this.renderer.height)}updateTransform(){this.dirtyFrame=this.scene.game.frame;const t=this.localTransform,e=this.worldTransform;t.tx=this.x,t.ty=this.y;const i=this.matrix,{a:r,b:s,c:n,d:a,tx:o,ty:h}=t,u=this.renderer.width*this.originX,c=this.renderer.height*this.originY;return i[0]=r,i[1]=s,i[4]=n,i[5]=a,i[12]=r*-u+n*-c+(u+o),i[13]=s*-u+a*-c+(c+h),e.a=r,e.b=s,e.c=n,e.d=a,e.tx=i[12],e.ty=i[13],this}}class I extends(C(E,[i])){constructor(t,e=0,i=0){super(),this.setScene(t),this.setPosition(e,i)}update(t,e){const i=this.children;for(let r=0;r<i.length;r++)i[r].update(t,e)}preRender(t,e){const i=this.scene.game;i.totalFrame++,this.dirtyFrame>=i.frame&&i.dirtyFrame++;const r=this.children;for(let t=0;t<r.length;t++);}updateTransform(){super.updateTransform();const t=this.children;for(let e=0;e<t.length;e++)t[e].updateTransform();return this}}class L extends I{constructor(t){super(t),this.renderList=[]}scanChildren(t){const e=t.getChildren();for(let t=0;t<e.length;t++)this.buildRenderList(e[t])}buildRenderList(t){const e=this.scene.game;t.willRender()&&(this.renderList.push(t),t.dirtyFrame>=e.frame&&e.dirtyFrame++),t.isParent&&this.scanChildren(t)}preRender(){return this.renderList=[],this.scanChildren(this),this.renderList}update(t,e){const i=this.children;for(let r=0;r<i.length;r++)i[r].update(t,e)}}var M={AnimatedSprite:R,Camera:F,Container:I,GameObject:E,Sprite:_,World:L},z=Object.freeze({__proto__:null,default:M});const B={linear:t=>t,inQuad:t=>t*t,outQuad:t=>t*(2-t),inOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,inCubic:t=>t*t*t,outCubic:t=>--t*t*t+1,inOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,inQuart:t=>t*t*t*t,outQuart:t=>1- --t*t*t*t,inOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,inQuint:t=>t*t*t*t*t,outQuint:t=>1+--t*t*t*t*t,inOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,inSine:t=>-1*Math.cos(t/1*(.5*Math.PI))+1,outSine:t=>Math.sin(t/1*(.5*Math.PI)),inOutSine:t=>-.5*(Math.cos(Math.PI*t)-1),inExpo:t=>0==t?0:Math.pow(2,10*(t-1)),outExpo:t=>1==t?1:1-Math.pow(2,-10*t),inOutExpo:t=>0==t?0:1==t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t)),inCirc:t=>-1*(Math.sqrt(1-t*t)-1),outCirc:t=>Math.sqrt(1-(t-=1)*t),inOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),inElastic:t=>{if(0==t)return 0;if(1==t)return 1;let e=1.70158,i=0;return i||(i=.3),e=i/(2*Math.PI)*Math.asin(1),-1*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)},outElastic:t=>{if(0==t)return 0;if(1==t)return 1;let e=1.70158,i=0;return i||(i=.3),e=i/(2*Math.PI)*Math.asin(1),1*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/i)+1},inOutElastic:t=>{if(0==t)return 0;if(2==(t/=.5))return 1;let e=1.70158,i=0;return i||(i=.3*1.5),e=i/(2*Math.PI)*Math.asin(1),t<1?1*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)*-.5:1*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)*.5+1},inBack:(t,e=1.70158)=>1*t*t*((e+1)*t-e),outBack:(t,e=1.70158)=>1*((t=t/1-1)*t*((e+1)*t+e)+1),inOutBack:(t,e=1.70158)=>(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2),inBounce:t=>1-B.outBounce(1-t),outBounce:t=>(t/=1)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,inOutBounce:t=>t<.5?.5*B.inBounce(2*t):.5*B.outBounce(2*t-1)+.5};var P={AppendMatrix2d:function(t,e){const i=t.a,r=t.b,s=t.c,n=t.d;return{a:e.a*i+e.b*s,b:e.a*r+e.b*n,c:e.c*i+e.d*s,d:e.c*r+e.d*n,tx:e.tx*i+e.ty*s+t.tx,ty:e.tx*r+e.ty*n+t.ty}},Ease:function(t,e){if(B[e])return B[e](t)},GlobalToLocal:A,LocalToGlobal:y,Vec2:s},D=Object.freeze({__proto__:null,default:P});function U(t,e){let i;if(Array.isArray(e.textures)?i=e.textures[0].frames:Array.isArray(e.frames)?i=e.frames:e.hasOwnProperty("frames")?i=Object.values(e.frames):console.warn("Invalid Texture Atlas JSON"),i){let e;for(let r=0;r<i.length;r++){let s=i[r];e=t.add(s.filename,s.frame.x,s.frame.y,s.frame.w,s.frame.h),s.trimmed?e.setTrim(s.sourceSize.w,s.sourceSize.h,s.spriteSourceSize.x,s.spriteSourceSize.y,s.spriteSourceSize.w,s.spriteSourceSize.h):e.setSourceSize(s.sourceSize.w,s.sourceSize.h),s.rotated,s.anchor&&e.setPivot(s.anchor.x,s.anchor.y)}}}function k(t,e,i,r,s,n){let{frameWidth:a=null,frameHeight:o=null,startFrame:h=0,endFrame:u=-1,margin:c=0,spacing:l=0}=n;if(o||(o=a),null===a)throw new Error("TextureManager.SpriteSheet: Invalid frameWidth given.");let d=Math.floor((r-c+l)/(a+l))*Math.floor((s-c+l)/(o+l));0===d&&console.warn("SpriteSheet frame dimensions will result in zero frames."),(h>d||h<-d)&&(h=0),h<0&&(h=d+h),-1!==u&&(d=h+(u+1));let p=c,m=c,x=0,f=0;for(let n=0;n<d;n++){x=0,f=0;let h=p+a,u=m+o;h>r&&(x=h-r),u>s&&(f=u-s),t.add(n,e+p,i+m,a-x,o-f),p+=a+l,p+a>r&&(p=c,m+=o+l)}}class O{constructor(t){this.game=t,this.textures=new Map}get(t){return this.textures.has(t)?this.textures.get(t):this.textures.get("__MISSING")}addImage(t,e){let i=null;return this.textures.has(t)||(i=new g(t,e),i.glTexture=this.game.renderer.createGLTexture(i.image),this.textures.set(t,i)),i}addSpriteSheet(t,e,i){let r=null;return this.textures.has(t)||(r=new g(t,e),r.glTexture=this.game.renderer.createGLTexture(r.image),k(r,0,0,r.width,r.height,i),this.textures.set(t,r)),r}addAtlas(t,e,i){let r=null;return this.textures.has(t)||(r=new g(t,e),r.glTexture=this.game.renderer.createGLTexture(r.image),U(r,i),this.textures.set(t,r)),r}addColor(t,e,i=32,r=32){return this.addGrid(t,e,e,i,r,0,0)}addGrid(t,e,i,r=32,s=32,n=2,a=2){let o=null;if(!this.textures.has(t)){const h=this.createCanvas(r,s),u=r/n,c=s/a;h.fillStyle=e,h.fillRect(0,0,r,s),h.fillStyle=i;for(let t=0;t<a;t++)for(let e=t%2;e<n;e+=2)h.fillRect(e*u,t*c,u,c);o=new g(t,h.canvas),o.glTexture=this.game.renderer.createGLTexture(o.image),this.textures.set(t,o)}return o}createCanvas(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i.getContext("2d")}}var X={AtlasParser:U,Frame:f,SpriteSheetParser:k,Texture:g,TextureManager:O},N=Object.freeze({__proto__:null,default:X});const G=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Y(t){let e="";for(let i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}const q={fragmentShader:"\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture[%count%];\n\nvoid main (void)\n{\n    vec4 color;\n\n    %forloop%\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}",vertexShader:"\nprecision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\nattribute vec4 aTintColor;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vTintColor = aTintColor;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}"};class H{constructor(t,e={}){this.renderer=t,this.gl=t.gl;const{batchSize:i=4096,dataSize:r=4,indexSize:s=4,vertexElementSize:n=6,quadIndexSize:a=6,fragmentShader:o=q.fragmentShader,vertexShader:h=q.vertexShader}=e;this.batchSize=i,this.dataSize=r,this.indexSize=s,this.vertexElementSize=n,this.vertexByteSize=n*r,this.quadByteSize=4*this.vertexByteSize,this.quadElementSize=4*n,this.quadIndexSize=a,this.bufferByteSize=i*this.quadByteSize,this.createBuffers(),this.createShaders(o,h)}createBuffers(){let t=[];for(let e=0;e<this.batchSize*this.indexSize;e+=this.indexSize)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(t),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const e=this.gl;this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t=[]}createShaders(t,e){const i=this.gl,r=this.renderer.maxTextures;let s="";for(let t=0;t<r;t++)t>0&&(s+="\n    else "),t<r-1&&(s+=`if (vTextureId < ${t}.5)`),s+="\n    {",s+=`\n        color = texture2D(uTexture[${t}], vTextureCoord);`,s+="\n    }";t=(t=t.replace(/%count%/gi,`${r}`)).replace(/%forloop%/gi,s);const n=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(n,t),i.compileShader(n);const a=i.createShader(i.VERTEX_SHADER);i.shaderSource(a,e),i.compileShader(a);const o=i.createProgram();i.attachShader(o,a),i.attachShader(o,n),i.linkProgram(o),i.useProgram(o),this.program=o;const h=i.getAttribLocation(o,"aVertexPosition"),u=i.getAttribLocation(o,"aTextureCoord"),c=i.getAttribLocation(o,"aTextureId"),l=i.getAttribLocation(o,"aTintColor"),d=i.getUniformLocation(o,"uProjectionMatrix"),p=i.getUniformLocation(o,"uCameraMatrix"),m=i.getUniformLocation(o,"uTexture");i.enableVertexAttribArray(h),i.enableVertexAttribArray(u),i.enableVertexAttribArray(c),i.enableVertexAttribArray(l),this.attribs={position:h,textureCoord:u,textureIndex:c,color:l},this.uniforms={projectionMatrix:d,cameraMatrix:p,textureLocation:m}}bind(t){const e=this.gl,i=this.renderer,r=this.uniforms;e.useProgram(this.program),e.uniformMatrix4fv(r.projectionMatrix,!1,i.projectionMatrix),e.uniformMatrix4fv(r.cameraMatrix,!1,t.matrix),e.uniform1iv(r.textureLocation,i.textureIndex),this.bindBuffers(this.indexBuffer,this.vertexBuffer)}bindBuffers(t,e){const i=this.gl,r=this.vertexByteSize,s=this.attribs;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),i.bindBuffer(i.ARRAY_BUFFER,e),i.vertexAttribPointer(s.position,2,i.FLOAT,!1,r,0),i.vertexAttribPointer(s.textureCoord,2,i.FLOAT,!1,r,8),i.vertexAttribPointer(s.textureIndex,1,i.FLOAT,!1,r,16),i.vertexAttribPointer(s.color,4,i.UNSIGNED_BYTE,!0,r,20),this.count=0}batchSprite(t){this.count===this.batchSize&&this.flush(),t.updateVertices(this.vertexViewF32,this.vertexViewU32,this.count*this.quadElementSize),this.count++}flush(){const t=this.count;if(0===t)return;const e=this.gl,i=t*this.quadByteSize;if(i===this.bufferByteSize)e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW);else{let t=this.vertexViewF32.subarray(0,i);e.bufferSubData(e.ARRAY_BUFFER,0,t)}e.drawElements(e.TRIANGLES,t*this.quadIndexSize,e.UNSIGNED_SHORT,0),this.count=0}}class V{constructor(t,e,i=1){this.contextOptions={alpha:!1,antialias:!1,premultipliedAlpha:!1,stencil:!1,preserveDrawingBuffer:!1},this.clearColor=[0,0,0,1],this.maxTextures=0,this.clearBeforeRender=!0,this.optimizeRedraw=!0,this.autoResize=!0,this.contextLost=!1,this.width=t,this.height=e,this.resolution=i;const r=document.createElement("canvas");r.addEventListener("webglcontextlost",t=>this.onContextLost(t),!1),r.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=r,this.initContext(),this.shader=new H(this)}initContext(){const t=this.canvas.getContext("webgl",this.contextOptions);this.gl=t,this.elementIndexExtension=t.getExtension("OES_element_index_uint"),this.getMaxTextures(),this.shader&&(this.shader.gl=t),this.resize(this.width,this.height,this.resolution)}resize(t,e,i=1){this.width=t*i,this.height=e*i,this.resolution=i;const r=this.canvas;r.width=this.width,r.height=this.height,this.autoResize&&(r.style.width=this.width/i+"px",r.style.height=this.height/i+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=this.ortho(t,e,-1e4,1e4)}ortho(t,e,i,r){return new Float32Array([1/-t*-2,0,0,0,0,1/e*-2,0,0,0,0,1/(i-r)*2,0,-1,1,0,1])}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){const e=this.clearColor,i=t>>16&255,r=t>>8&255,s=255&t,n=t>16777215?t>>>24:255;return e[0]=i/255,e[1]=r/255,e[2]=s/255,e[3]=n/255,this}getMaxTextures(){const t=this.gl;let e=function(t,e){const i=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=G.replace(/%forloop%/gi,Y(t));if(e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),t);for(let i=0;i<e;i++){let e=t.createTexture();t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]))}this.maxTextures=e,this.textureIndex=Array.from(Array(e).keys()),this.activeTextures=Array(e),this.currentActiveTexture=0,this.startActiveTexture=0}isSizePowerOfTwo(t,e){return!(t<1||e<1)&&(0==(t&t-1)&&0==(e&e-1))}createGLTexture(t){const e=this.gl,i=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);const r=this.isSizePowerOfTwo(t.width,t.height),s=r?e.REPEAT:e.CLAMP_TO_EDGE;return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s),r&&e.generateMipmap(e.TEXTURE_2D),i}render(t,e,i){if(this.contextLost)return;const r=this.gl;if(r.bindFramebuffer(r.FRAMEBUFFER,null),this.optimizeRedraw&&0===i)return;this.currentActiveTexture=0,this.startActiveTexture++;const s=this.shader;r.viewport(0,0,this.width,this.height),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);const n=this.clearColor;this.clearBeforeRender&&(r.clearColor(n[0],n[1],n[2],n[3]),r.clear(r.COLOR_BUFFER_BIT)),s.bind(e);const a=this.maxTextures,o=this.activeTextures,h=this.startActiveTexture;for(let e=0;e<t.length;e++){let i=t[e],n=i.texture;n.glIndexCounter<h&&(n.glIndexCounter=h,this.currentActiveTexture<a&&(o[this.currentActiveTexture]=n,n.glIndex=this.currentActiveTexture,r.activeTexture(r.TEXTURE0+this.currentActiveTexture),r.bindTexture(r.TEXTURE_2D,n.glTexture),this.currentActiveTexture++)),s.batchSprite(i)}s.flush()}}class j{constructor(t,e,i,r,s){this.hasLoaded=!1,this.type=t,this.key=e,this.url=i,this.loadHandler=r,this.config=s}}class Q{constructor(t){this.baseURL="",this.path="",this.crossOrigin=void 0,this.maxParallelDownloads=32,this.isLoading=!1,this.game=t,this.reset()}reset(){this.isLoading=!1,this.queue=[],this.inflight=new Map}start(t){this.isLoading||(this.queue.length>0?(this.isLoading=!0,this.onComplete=t,this.nextFile()):t())}nextFile(){if(this.queue.length){let t=this.queue.shift();this.inflight.set(t.url,t),t.loadHandler(t)}else 0===this.inflight.size&&this.stop()}stop(){this.isLoading=!1,this.onComplete()}fileComplete(t){if(t.linkFile&&t.linkFile.hasLoaded){const e="atlasimage"===t.type?t:t.linkFile,i="atlasjson"===t.type?t:t.linkFile;this.game.textures.addAtlas(t.key,e.data,i.data)}this.inflight.delete(t.url),this.nextFile()}fileError(t){this.inflight.delete(t.url),this.nextFile()}totalFilesToLoad(){return this.queue.length+this.inflight.size}image(t,e){let i=new j("image",t,this.getURL(t,e,".png"),t=>this.imageTagLoader(t));return this.queue.push(i),this}spritesheet(t,e,i){let r=new j("spritesheet",t,this.getURL(t,e,".png"),t=>this.imageTagLoader(t));return r.config=i,this.queue.push(r),this}atlas(t,e,i){let r=new j("atlasimage",t,this.getURL(t,e,".png"),t=>this.imageTagLoader(t)),s=new j("atlasjson",t,this.getURL(t,i,".json"),t=>this.XHRLoader(t));return s.config={responseType:"text"},r.linkFile=s,s.linkFile=r,this.queue.push(r),this.queue.push(s),this}json(t,e){let i=new j("json",t,this.getURL(t,e,".json"),t=>this.XHRLoader(t));return i.config={responseType:"text"},this.queue.push(i),this}csv(t,e){let i=new j("csv",t,this.getURL(t,e,".csv"),t=>this.XHRLoader(t));return i.config={responseType:"text"},this.queue.push(i),this}XHRLoader(t){const e=new XMLHttpRequest;e.open("GET",t.url,!0),e.responseType=t.config.responseType,e.onload=i=>{t.hasLoaded=!0,"json"===t.type||"atlasjson"===t.type?t.data=JSON.parse(e.responseText):t.data=e.responseText,this.fileComplete(t)},e.onerror=()=>{t.hasLoaded=!0,this.fileError(t)},e.send()}imageTagLoader(t){t.data=new Image,this.crossOrigin&&(t.data.crossOrigin=this.crossOrigin),t.data.onload=()=>{t.data.onload=null,t.data.onerror=null,t.hasLoaded=!0,"image"===t.type?this.game.textures.addImage(t.key,t.data):"spritesheet"===t.type&&this.game.textures.addSpriteSheet(t.key,t.data,t.config),this.fileComplete(t)},t.data.onerror=()=>{t.data.onload=null,t.data.onerror=null,t.hasLoaded=!0,this.fileError(t)},t.data.src=t.url,t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,t.hasLoaded=!0,"image"===t.type?this.game.textures.addImage(t.key,t.data):"spritesheet"===t.type&&this.game.textures.addSpriteSheet(t.key,t.data,t.config),this.fileComplete(t))}getURL(t,e,i){return e||(e=t+i),e.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?e:this.baseURL+this.path+e}setBaseURL(t){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.baseURL=t,this}setPath(t){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.path=t,this}setCORS(t){return this.crossOrigin=t,this}}class W{constructor(t,e,i=!1){this.callback=t,this.context=e,this.once=i}}class K{constructor(){this._events=new Map}on(t,e,i=this,r=!1){if("function"!=typeof e)throw new TypeError("The listener must be a function");const s=new W(e,i,r),n=this._events.get(t);return n?n.add(s):this._events.set(t,new Set([s])),this}once(t,e,i=this){return this.on(t,e,i,!0)}clearEvent(t){return this._events.delete(t),this}eventNames(){return[...this._events.keys()]}listeners(t){const e=[];return this._events.get(t).forEach(t=>{e.push(t.callback)}),e}listenerCount(t){const e=this._events.get(t);return e?e.size:0}emit(t,...e){if(!this._events.has(t))return!1;const i=this._events.get(t);for(const t of i)t.callback.apply(t.context,e),t.once&&i.delete(t);return 0===i.size&&this._events.delete(t),!0}off(t,e,i,r){if(e){const s=this._events.get(t),n=!i,a=void 0!==r;for(const t of s)t.callback===e&&n&&t.context===console&&a&&t.once===r&&s.delete(t);0===s.size&&this._events.delete(t)}else this._events.delete(t);return this}removeAllListeners(t){t?this._events.delete(t):this._events.clear()}}return{Game:class extends K{constructor(t){super(),this.VERSION="4.0.0-beta2",this.isPaused=!1,this.isBooted=!1,this.lifetime=0,this.elapsed=0,this.frame=0,this.dirtyFrame=0,this.totalFrame=0;const{width:e=800,height:i=600,backgroundColor:r=0,parent:s=document.body,scene:n=null}=t;this.config={width:e,height:i,backgroundColor:r,parent:s,scene:n},function(t){if("complete"===document.readyState||"interactive"===document.readyState)return void t();const e=()=>{document.removeEventListener("deviceready",e,!0),document.removeEventListener("DOMContentLoaded",e,!0),window.removeEventListener("load",e,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",e,!0):(document.addEventListener("DOMContentLoaded",e,!0),window.addEventListener("load",e,!0)):window.setTimeout(e,20)}(()=>this.boot())}pause(){this.isPaused=!0,this.emit("pause")}resume(){this.isPaused=!1,this.lastTick=Date.now(),this.emit("resume")}boot(){this.isBooted=!0,this.lastTick=Date.now(),this.textures=new O(this),this.loader=new Q(this);const t=this.config,e=new V(t.width,t.height);e.setBackgroundColor(t.backgroundColor),function(t,e){let i;if(e)"string"==typeof e?i=document.getElementById(e):"object"==typeof e&&1===e.nodeType&&(i=e);else if(t.parentElement)return t;i||(i=document.body),i.appendChild(t)}(e.canvas,t.parent),this.renderer=e,this.banner(this.VERSION),document.addEventListener("visibilitychange",()=>{this.emit("visibilitychange",document.hidden),document.hidden?this.pause():this.resume()})}start(){requestAnimationFrame(()=>this.step())}banner(t){console.log("%c  %c  %cPhaser Nano v"+t+"%c https://phaser4.io","padding: 2px; background: linear-gradient(to right, #00bcc3, #3e0081)","padding: 2px; background: #3e0081 url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJ1BMVEUALon///+9tJQAAABv9v92d2IAn6qHEhL/DQ3/fCUOOlNMPUD/uz24pItZAAAAaElEQVQI12OAA/YCKKPyOANbWgKQUdFZkOLiBmJ0zHIRdAEKWXR0uQimABnWu3elpIEYhoKCYS4ui8EModBQRQMG09AgQSBQBmpvBzOABhYpAYEBg3FpEJAOZgCqAdEGDAzGIACk4QAAsv0aPCHrnowAAAAASUVORK5CYII=) no-repeat;","padding: 2px 20px 2px 8px; color: #fff; background: linear-gradient(to right, #3e0081 90%, #3e0081 10%, #00bcc3)","")}step(){const t=Date.now(),e=(t-this.lastTick)/1e3;this.lifetime+=e,this.elapsed=e,this.lastTick=t,this.emit("step",e,t),this.isPaused||this.scenes.update(e,t),this.emit("update",e,t),this.dirtyFrame=0,this.totalFrame=0,this.scenes.render(),this.emit("render",e,t),this.frame++,requestAnimationFrame(()=>this.step())}destroy(){}},Scene:class{constructor(t){this.game=t,this.load=t.loader,this.textures=t.textures,this.world=new L(this),this.camera=new F(this,0,0)}init(){}preload(){}create(){}update(t,e){}},Components:w,EventEmitter:K,GameObjects:z,Loader:Q,Math:D,WebGLRenderer:V,Textures:N}}));
