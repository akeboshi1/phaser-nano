!function(){"use strict";const t=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function e(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}const r={fragmentShader:"\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture[%count%];\n\nvoid main (void)\n{\n    vec4 color;\n\n    %forloop%\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}",vertexShader:"\nprecision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\nattribute vec4 aTintColor;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vTintColor = aTintColor;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}"};class i{constructor(t,e={}){this.renderer=t,this.gl=t.gl;const{batchSize:i=4096,dataSize:s=4,indexSize:n=4,vertexElementSize:o=6,quadIndexSize:h=6,fragmentShader:a=r.fragmentShader,vertexShader:c=r.vertexShader}=e;this.batchSize=i,this.dataSize=s,this.indexSize=n,this.vertexElementSize=o,this.vertexByteSize=o*s,this.quadByteSize=4*this.vertexByteSize,this.quadElementSize=4*o,this.quadIndexSize=h,this.bufferByteSize=i*this.quadByteSize,this.createBuffers(),this.createShaders(a,c)}createBuffers(){let t=[];for(let e=0;e<this.batchSize*this.indexSize;e+=this.indexSize)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(t),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const e=this.gl;this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t=[]}createShaders(t,e){const r=this.gl,i=this.renderer.maxTextures;let s="";for(let t=0;t<i;t++)t>0&&(s+="\n    else "),t<i-1&&(s+=`if (vTextureId < ${t}.5)`),s+="\n    {",s+=`\n        color = texture2D(uTexture[${t}], vTextureCoord);`,s+="\n    }";t=(t=t.replace(/%count%/gi,`${i}`)).replace(/%forloop%/gi,s);const n=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(n,t),r.compileShader(n);const o=r.createShader(r.VERTEX_SHADER);r.shaderSource(o,e),r.compileShader(o);const h=r.createProgram();r.attachShader(h,o),r.attachShader(h,n),r.linkProgram(h),r.useProgram(h),this.program=h;const a=r.getAttribLocation(h,"aVertexPosition"),c=r.getAttribLocation(h,"aTextureCoord"),u=r.getAttribLocation(h,"aTextureId"),d=r.getAttribLocation(h,"aTintColor"),l=r.getUniformLocation(h,"uProjectionMatrix"),x=r.getUniformLocation(h,"uCameraMatrix"),f=r.getUniformLocation(h,"uTexture");r.enableVertexAttribArray(a),r.enableVertexAttribArray(c),r.enableVertexAttribArray(u),r.enableVertexAttribArray(d),this.attribs={position:a,textureCoord:c,textureIndex:u,color:d},this.uniforms={projectionMatrix:l,cameraMatrix:x,textureLocation:f}}bind(t){const e=this.gl,r=this.renderer,i=this.uniforms;e.useProgram(this.program),e.uniformMatrix4fv(i.projectionMatrix,!1,r.projectionMatrix),e.uniformMatrix4fv(i.cameraMatrix,!1,t.matrix),e.uniform1iv(i.textureLocation,r.textureIndex),this.bindBuffers(this.indexBuffer,this.vertexBuffer)}bindBuffers(t,e){const r=this.gl,i=this.vertexByteSize,s=this.attribs;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),r.bindBuffer(r.ARRAY_BUFFER,e),r.vertexAttribPointer(s.position,2,r.FLOAT,!1,i,0),r.vertexAttribPointer(s.textureCoord,2,r.FLOAT,!1,i,8),r.vertexAttribPointer(s.textureIndex,1,r.FLOAT,!1,i,16),r.vertexAttribPointer(s.color,4,r.UNSIGNED_BYTE,!0,i,20),this.count=0}batchSprite(t){this.count===this.batchSize&&this.flush(),t.updateVertices(this.vertexViewF32,this.vertexViewU32,this.count*this.quadElementSize),this.count++}flush(){const t=this.count;if(0===t)return;const e=this.gl,r=t*this.quadByteSize;if(r===this.bufferByteSize)e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW);else{let t=this.vertexViewF32.subarray(0,r);e.bufferSubData(e.ARRAY_BUFFER,0,t)}e.drawElements(e.TRIANGLES,t*this.quadIndexSize,e.UNSIGNED_SHORT,0),this.count=0}}class s{constructor(t,e,r=1){this.contextOptions={alpha:!1,antialias:!1,premultipliedAlpha:!1,stencil:!1,preserveDrawingBuffer:!1},this.clearColor=[0,0,0,1],this.maxTextures=0,this.clearBeforeRender=!0,this.optimizeRedraw=!0,this.autoResize=!0,this.contextLost=!1,this.width=t,this.height=e,this.resolution=r;const s=document.createElement("canvas");s.addEventListener("webglcontextlost",t=>this.onContextLost(t),!1),s.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=s,this.initContext(),this.shader=new i(this)}initContext(){const t=this.canvas.getContext("webgl",this.contextOptions);this.gl=t,this.elementIndexExtension=t.getExtension("OES_element_index_uint"),this.getMaxTextures(),this.shader&&(this.shader.gl=t),this.resize(this.width,this.height,this.resolution)}resize(t,e,r=1){this.width=t*r,this.height=e*r,this.resolution=r;const i=this.canvas;i.width=this.width,i.height=this.height,this.autoResize&&(i.style.width=this.width/r+"px",i.style.height=this.height/r+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=this.ortho(t,e,-1e4,1e4)}ortho(t,e,r,i){return new Float32Array([1/-t*-2,0,0,0,0,1/e*-2,0,0,0,0,1/(r-i)*2,0,-1,1,0,1])}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){const e=this.clearColor,r=t>>16&255,i=t>>8&255,s=255&t,n=t>16777215?t>>>24:255;return e[0]=r/255,e[1]=i/255,e[2]=s/255,e[3]=n/255,this}getMaxTextures(){const r=this.gl;let i=function(r,i){const s=i.createShader(i.FRAGMENT_SHADER);for(;;){const n=t.replace(/%forloop%/gi,e(r));if(i.shaderSource(s,n),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS))break;r=r/2|0}return r}(r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),r);for(let t=0;t<i;t++){let e=r.createTexture();r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]))}this.maxTextures=i,this.textureIndex=Array.from(Array(i).keys()),this.activeTextures=Array(i),this.currentActiveTexture=0,this.startActiveTexture=0}isSizePowerOfTwo(t,e){return!(t<1||e<1)&&(0==(t&t-1)&&0==(e&e-1))}createGLTexture(t){const e=this.gl,r=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);const i=this.isSizePowerOfTwo(t.width,t.height),s=i?e.REPEAT:e.CLAMP_TO_EDGE;return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s),i&&e.generateMipmap(e.TEXTURE_2D),r}render(t,e){if(this.contextLost)return;const r=this.gl;if(r.bindFramebuffer(r.FRAMEBUFFER,null),this.optimizeRedraw&&0===e)return;this.currentActiveTexture=0,this.startActiveTexture++;const i=this.shader;r.viewport(0,0,this.width,this.height),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA);const s=this.clearColor;this.clearBeforeRender&&(r.clearColor(s[0],s[1],s[2],s[3]),r.clear(r.COLOR_BUFFER_BIT));const n=this.maxTextures,o=this.activeTextures,h=this.startActiveTexture;for(let e=0;e<t.length;e+=2){let s=t[e],a=t[e+1];i.bind(s);for(let t=0;t<a.length;t++){let e=a[t],s=e.texture;s.glIndexCounter<h&&(s.glIndexCounter=h,this.currentActiveTexture<n&&(o[this.currentActiveTexture]=s,s.glIndex=this.currentActiveTexture,r.activeTexture(r.TEXTURE0+this.currentActiveTexture),r.bindTexture(r.TEXTURE_2D,s.glTexture),this.currentActiveTexture++)),i.batchSprite(e)}i.flush()}}}function n(t,e){let r=t;return e.forEach(t=>{r=t(r)}),r}function o(t){return class extends t{constructor(){super(...arguments),this._alpha=1}setAlpha(t=1){return t!==this._alpha&&(this._alpha=t,this.setDirty()),this}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.setDirty())}}}function h(t){return class extends t{constructor(...t){super(t),this.children=[],this.isParent=!0}getChildren(){return this.children}addChild(...t){return t.forEach(t=>{this.addChildAt(t,this.children.length)}),this}addChildAt(t,e){return e>=0&&e<=this.children.length&&(t.parent&&t.parent.removeChild(t),t.setParent(this),this.children.splice(e,0,t),t.updateTransform()),t}swapChildren(t,e){if(t===e)return this;const r=this.getChildIndex(t),i=this.getChildIndex(e);if(r<0||i<0)throw new Error("swap: Both children must belong to the same parent");return this.children[r]=e,this.children[i]=t,this}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("Supplied DisplayObject not child of the caller");return e}setChildIndex(t,e){const r=this.children;if(e<0||e>=r.length)throw new Error("Index "+e+" out of bounds");const i=this.getChildIndex(t);return r.splice(i,1),r.splice(e,0,t),this}getChildAt(t){if(t<0||t>=this.numChildren)throw new Error("Index "+t+" out of bounds");return this.children[t]}removeChild(t){const e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)}removeChildAt(t){const e=this.getChildAt(t);return e&&(e.parent=void 0,e.updateTransform(),this.children.splice(t,1)),e}removeChildren(t=0,e){const r=this.children;void 0===e&&(e=r.length);const i=e-t;if(i>0&&i<=e){const e=r.splice(t,i);return e.forEach(t=>{t.parent=void 0,t.updateTransform()}),e}if(0===i&&0===r.length)return[];throw new Error("Range Error. Values out of bounds")}update(t,e){const r=this.children;for(let i=0;i<r.length;i++)r[i].update(t,e)}get numChildren(){return this.children.length}}}function a(t){return class extends t{constructor(){super(...arguments),this.dirty=!0,this.dirtyFrame=0}setDirty(t=!0){return this.dirty=!0,t&&(this.dirtyFrame=this.scene.game.frame),this}}}class c{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}zero(){return this.set()}getArray(){return[this.x,this.y]}fromArray(t){return this.set(t[0],t[1])}[Symbol.iterator](){return this.getArray()[Symbol.iterator]()}}function u(t){return class extends t{constructor(){super(...arguments),this._origin=new c(.5,.5)}setOrigin(t,e=t){return this._origin.set(t,e),this}get originX(){return this._origin.x}set originX(t){this._origin.x=t}get originY(){return this._origin.y}set originY(t){this._origin.y=t}}}function d(t){return class extends t{constructor(){super(...arguments),this.isParent=!1}setParent(t){return this.parent=t,this}update(t,e){}}}function l(t){return class extends t{constructor(){super(...arguments),this._position=new c}setPosition(t,e=t){return this._position.set(t,e),this.updateTransform()}set x(t){this._position.x=t,this.updateTransform()}get x(){return this._position.x}set y(t){this._position.y=t,this.updateTransform()}get y(){return this._position.y}}}function x(t){return class extends t{constructor(...t){super(t),this._alpha=1,this.vertexAlpha=new Float32Array(4).fill(1)}setAlpha(t=1,e=t,r=t,i=t){const s=this.vertexAlpha;return s[0]=t,s[1]=e,s[2]=r,s[3]=i,this.packColors()}get alpha(){return this._alpha}set alpha(t){this._alpha=t,this.setAlpha(t)}}}function f(t){return class extends t{constructor(...t){super(t),this._tint=16777215,this.vertexTint=new Uint32Array(4).fill(16777215)}setTint(t=16777215,e=t,r=t,i=t){const s=this.vertexTint;return s[0]=t,s[1]=e,s[2]=r,s[3]=i,this.packColors()}get tint(){return this._tint}set tint(t){this._tint=t,this.setTint(t)}}}function g(t){return class extends t{constructor(){super(...arguments),this.renderable=!0}setRenderable(t){return this.renderable=t,this}willRender(){return this.visible&&this.renderable&&this.alpha>0&&this.hasTexture}}}function m(t){return class extends t{constructor(){super(...arguments),this._rotation=0}setRotation(t){return t!==this._rotation&&(this._rotation=t,this.updateCache()),this}set rotation(t){t!==this._rotation&&(this._rotation=t,this.updateCache())}get rotation(){return this._rotation}}}function p(t){return class extends t{constructor(){super(...arguments),this._scale=new c(1,1)}setScale(t,e=t){return this._scale.set(t,e),this.updateCache()}set scaleX(t){t!==this._scale.x&&(this._scale.x=t,this.updateCache())}get scaleX(){return this._scale.x}set scaleY(t){t!==this._scale.y&&(this._scale.y=t,this.updateCache())}get scaleY(){return this._scale.y}}}function T(t){return class extends t{setScene(t){return this.scene=t,this}}}function v(t){return class extends t{setSize(t,e){return this.width=t,this.height=e,this}}}function w(t){return class extends t{constructor(){super(...arguments),this._skew=new c(0,0)}setSkew(t,e=t){return this._skew.set(t,e),this.updateCache()}set skewX(t){t!==this._skew.x&&(this._skew.x=t,this.updateCache())}get skewX(){return this._skew.x}set skewY(t){t!==this._skew.y&&(this._skew.y=t,this.updateCache())}get skewY(){return this._skew.y}}}class S{constructor(t,e,r,i,s,n){this.trimmed=!1,this.texture=t,this.key=e,this.x=r,this.y=i,this.width=s,this.height=n,this.sourceSizeWidth=s,this.sourceSizeHeight=n,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,r,i,s,n){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=r,this.spriteSourceSizeY=i,this.spriteSourceSizeWidth=s,this.spriteSourceSizeHeight=n}updateUVs(){const{x:t,y:e,width:r,height:i}=this,s=this.texture.width,n=this.texture.height;this.u0=t/s,this.v0=e/n,this.u1=(t+r)/s,this.v1=(e+i)/n}}class y{constructor(t,e){this.glIndex=0,this.glIndexCounter=-1,this.key=t,this.image=e,this.width=e.width,this.height=e.height,this.frames=new Map,this.add("__BASE",0,0,e.width,e.height)}add(t,e,r,i,s){if(this.frames.has(t))return null;let n=new S(this,t,e,r,i,s);return this.frames.set(t,n),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=n),n}get(t){if(!t)return this.firstFrame;t instanceof S&&(t=t.key);let e=this.frames.get(t);return e||(console.warn("Texture.frame missing: "+t),e=this.firstFrame),e}getFrames(t){const e=[];return t.forEach(t=>{e.push(this.get(t))}),e}getFramesInRange(t,e,r,i=0,s=""){const n=[],o=e<r?1:-1;r+=o;for(let h=e;h!==r;h+=o)n.push(t+h.toString().padStart(i,"0")+s);return this.getFrames(n)}}function _(t){return class extends t{constructor(){super(...arguments),this.hasTexture=!1,this._prevTextureID=-1}setTexture(t,e){return this.texture=t instanceof y?t:this.scene.game.textures.get(t),this.texture?this.setFrame(e):console.warn("Invalid Texture key: "+t),this}setFrame(t){const e=this.texture.get(t);if(e===this.frame)return this;this.frame=e,this.setSize(e.sourceSizeWidth,e.sourceSizeHeight),e.pivot&&this.setOrigin(e.pivot.x,e.pivot.y);const r=this.vertexData;return r[2]=e.u0,r[3]=e.v0,r[8]=e.u0,r[9]=e.v1,r[14]=e.u1,r[15]=e.v1,r[20]=e.u1,r[21]=e.v0,this.setDirty(),this.hasTexture=!0,this}}}function E(t){return class extends t{constructor(...t){super(t),this.localTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this.worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0}}updateCache(){const t=this.localTransform,{rotation:e,skewX:r,skewY:i,scaleX:s,scaleY:n}=this;return t.a=Math.cos(e+i)*s,t.b=Math.sin(e+i)*s,t.c=-Math.sin(e-r)*n,t.d=Math.cos(e-r)*n,this.updateTransform()}updateTransform(){this.setDirty();const t=this.parent,e=this.localTransform,r=this.worldTransform;if(e.tx=this.x,e.ty=this.y,!t)return r.a=e.a,r.b=e.b,r.c=e.c,r.d=e.d,r.tx=e.tx,r.ty=e.ty,this;const i=t.worldTransform;let{a:s,b:n,c:o,d:h,tx:a,ty:c}=e;return r.a=s*i.a+n*i.c,r.b=s*i.b+n*i.d,r.c=o*i.a+h*i.c,r.d=o*i.b+h*i.d,r.tx=a*i.a+c*i.c+i.tx,r.ty=a*i.b+c*i.d+i.ty,this}localToGlobal(t,e,r=new c){return function(t,e,r,i=new c){const{a:s,b:n,c:o,d:h,tx:a,ty:u}=t;return i.x=s*e+o*r+a,i.y=n*e+h*r+u,i}(this.worldTransform,t,e,r)}globalToLocal(t,e,r=new c){return function(t,e,r,i=new c){const{a:s,b:n,c:o,d:h,tx:a,ty:u}=t,d=1/(s*h+o*-n);return i.x=h*d*e+-o*d*r+(u*o-a*h)*d,i.y=s*d*r+-n*d*e+(-u*s+a*n)*d,i}(this.worldTransform,t,e,r)}}}function b(t){return class extends t{constructor(){super(...arguments),this.visible=!0}setVisible(t){return this.visible=t,this}}}class A extends(n(class{},[o,a,d,u,l,g,m,p,T,v,w,E,b])){constructor(t,e=0,r=0){super(),this.scene=t,this._position.set(e,r),this.dirty=!0,this.name=""}}class C extends(n(A,[h])){constructor(t,e=0,r=0){super(),this.setScene(t),this.setPosition(e,r)}update(t,e){const r=this.children;for(let i=0;i<r.length;i++)r[i].update(t,e)}updateTransform(){super.updateTransform();const t=this.children;for(let e=0;e<t.length;e++)t[e].updateTransform();return this}}class R extends A{constructor(t,e=0,r=0){super(t,e,r),this.renderer=t.game.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.setSize(this.renderer.width,this.renderer.height)}updateTransform(){this.dirtyFrame=this.scene.game.frame;const t=this.localTransform,e=this.worldTransform;t.tx=this.x,t.ty=this.y;const r=this.matrix,{a:i,b:s,c:n,d:o,tx:h,ty:a}=t,c=this.renderer.width*this.originX,u=this.renderer.height*this.originY;return r[0]=i,r[1]=s,r[4]=n,r[5]=o,r[12]=i*-c+n*-u+(c+h),r[13]=s*-c+o*-u+(u+a),e.a=i,e.b=s,e.c=n,e.d=o,e.tx=r[12],e.ty=r[13],this}}class F extends C{constructor(t,e){super(t),this.dirtyFrame=0,this.totalFrame=0,this.name=e,this.renderList=[],this.camera=new R(t,0,0)}scanChildren(t,e){const r=t.getChildren();for(let t=0;t<r.length;t++)this.buildRenderList(r[t],e)}buildRenderList(t,e){t.willRender()&&(this.renderList.push(t),t.dirtyFrame>=e&&this.dirtyFrame++),t.isParent&&this.scanChildren(t,e)}update(t,e){const r=this.children;for(let i=0;i<r.length;i++)r[i].update(t,e)}render(t){return this.dirtyFrame=0,this.renderList.length=0,this.scanChildren(this,t),this.totalFrame=this.renderList.length,this.dirtyFrame}}class z{constructor(t,e="default"){this.game=t,this.world=new F(this,e)}}class I{constructor(t,e){this.dirtyFrame=0,this.totalFrame=0,this.game=t,this.scenes=new Map,this.renderList=[],(e=[].concat(e)).forEach(t=>{this.addScene(t)})}update(t,e){this.scenes.forEach(r=>{r.world.update(t,e)})}render(t){const e=this.renderList;return e.length=0,this.dirtyFrame=0,this.totalFrame=0,this.scenes.forEach(r=>{let i=r.world;this.dirtyFrame+=i.render(t),this.totalFrame+=i.totalFrame,e.push(i.camera),e.push(i.renderList)}),this.dirtyFrame}addScene(t){let e;t instanceof z?e=this.createSceneFromInstance(t):"object"==typeof t?e=this.createSceneFromObject(t):"function"==typeof t&&(e=this.createSceneFromFunction(t)),console.log("Scene.addScene",e.world.name),this.scenes.set(e.world.name,e)}createSceneFromInstance(t){return t.game=this.game,t}createSceneFromObject(t){let e=new z(this.game);return["init","preload","create","update","render"].forEach(r=>{t.hasOwnProperty(r)&&(e[r]=t[r])}),e}createSceneFromFunction(t){var e=new t(this.game);return e instanceof z?this.createSceneFromInstance(e):e}}class L{constructor(t){this.game=t,this.textures=new Map}get(t){return this.textures.has(t)?this.textures.get(t):this.textures.get("__MISSING")}add(t,e){let r;return this.textures.has(t)||(e instanceof y?(r=e,r.key=t):r=new y(t,e),r.glTexture=this.game.renderer.createGLTexture(r.image),this.textures.set(t,r)),r}}class B{constructor(t,e,r=!1){this.callback=t,this.context=e,this.once=r}}class D extends class{constructor(){this._events=new Map}on(t,e,r=this,i=!1){if("function"!=typeof e)throw new TypeError("The listener must be a function");const s=new B(e,r,i),n=this._events.get(t);return n?n.add(s):this._events.set(t,new Set([s])),this}once(t,e,r=this){return this.on(t,e,r,!0)}clearEvent(t){return this._events.delete(t),this}eventNames(){return[...this._events.keys()]}listeners(t){const e=[];return this._events.get(t).forEach(t=>{e.push(t.callback)}),e}listenerCount(t){const e=this._events.get(t);return e?e.size:0}emit(t,...e){if(!this._events.has(t))return!1;const r=this._events.get(t);for(const t of r)t.callback.apply(t.context,e),t.once&&r.delete(t);return 0===r.size&&this._events.delete(t),!0}off(t,e,r,i){if(e){const s=this._events.get(t),n=!r,o=void 0!==i;for(const t of s)t.callback===e&&n&&t.context===console&&o&&t.once===i&&s.delete(t);0===s.size&&this._events.delete(t)}else this._events.delete(t);return this}removeAllListeners(t){t?this._events.delete(t):this._events.clear()}}{constructor(t){super(),this.VERSION="4.0.0-beta1",this.isPaused=!1,this.isBooted=!1,this.lifetime=0,this.elapsed=0,this.frame=0;const{width:e=800,height:r=600,backgroundColor:i=0,parent:s=document.body,scene:n=null}=t;this.config={width:e,height:r,backgroundColor:i,parent:s,scene:n},function(t){if("complete"===document.readyState||"interactive"===document.readyState)return void t();const e=()=>{document.removeEventListener("deviceready",e,!0),document.removeEventListener("DOMContentLoaded",e,!0),window.removeEventListener("load",e,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",e,!0):(document.addEventListener("DOMContentLoaded",e,!0),window.addEventListener("load",e,!0)):window.setTimeout(e,20)}(()=>this.boot())}pause(){this.isPaused=!0,this.emit("pause")}resume(){this.isPaused=!1,this.lastTick=Date.now(),this.emit("resume")}boot(){const t=this.config;this.isBooted=!0,this.lastTick=Date.now();const e=new s(t.width,t.height);e.setBackgroundColor(t.backgroundColor),function(t,e){let r;if(e)"string"==typeof e?r=document.getElementById(e):"object"==typeof e&&1===e.nodeType&&(r=e);else if(t.parentElement)return t;r||(r=document.body),r.appendChild(t)}(e.canvas,t.parent),this.renderer=e,this.textures=new L(this),this.scenes=new I(this,t.scene),this.banner(this.VERSION),document.addEventListener("visibilitychange",()=>{this.emit("visibilitychange",document.hidden),document.hidden?this.pause():this.resume()}),this.emit("boot"),requestAnimationFrame(()=>this.step())}banner(t){console.log("%c  %cPhaser Nano v"+t+"%c https://phaser4.io","padding: 2px; background: linear-gradient(to right, #00bcc3, #3e0081)","padding: 2px 20px 2px 8px; color: #fff; background: linear-gradient(to right, #3e0081 90%, #3e0081 10%, #00bcc3)","")}step(){const t=Date.now(),e=(t-this.lastTick)/1e3;this.lifetime+=e,this.elapsed=e,this.lastTick=t,this.emit("step",e,t);const r=this.scenes;this.isPaused||r.update(e,t),this.emit("update",e,t);const i=r.render(this.frame);this.renderer.render(r.renderList,i),this.emit("render",e,t),this.frame++,requestAnimationFrame(()=>this.step())}destroy(){}}function P(t,e){return((255&(255*e|0))<<24|t)>>>0}class U extends(n(A,[h,x,f,_])){constructor(t,e,r,i,s){super(),this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.setScene(t),this.setTexture(i,s),this.setPosition(e,r)}packColors(){const t=this.vertexAlpha,e=this.vertexTint,r=this.vertexColor;return r[0]=P(e[0],t[0]),r[1]=P(e[1],t[1]),r[2]=P(e[2],t[2]),r[3]=P(e[3],t[3]),this.setDirty(),this}updateVertices(t,e,r){const i=this.vertexData;if(this.dirty){this.dirty=!1;const t=this.frame,e=this._origin;let r,s,n,o;const{a:h,b:a,c:c,d:u,tx:d,ty:l}=this.worldTransform;t.trimmed?(s=t.spriteSourceSizeX-e.x*t.sourceSizeWidth,r=s+t.spriteSourceSizeWidth,o=t.spriteSourceSizeY-e.y*t.sourceSizeHeight,n=o+t.spriteSourceSizeHeight):(s=-e.x*t.sourceSizeWidth,r=s+t.sourceSizeWidth,o=-e.y*t.sourceSizeHeight,n=o+t.sourceSizeHeight),i[0]=s*h+o*c+d,i[1]=s*a+o*u+l,i[6]=s*h+n*c+d,i[7]=s*a+n*u+l,i[12]=r*h+n*c+d,i[13]=r*a+n*u+l,i[18]=r*h+o*c+d,i[19]=r*a+o*u+l}const s=this.texture.glIndex;s!==this._prevTextureID&&(this._prevTextureID=s,i[4]=s,i[10]=s,i[16]=s,i[22]=s),t.set(i,r);const n=this.vertexColor;e[r+5]=n[0],e[r+11]=n[2],e[r+17]=n[3],e[r+23]=n[1]}}class k{constructor(t,e,r){this.crossOrigin=void 0,this.hasLoaded=!1,this.key=t,this.url=e,this.config=r}}function M(t,e,r){const i=new k(e,function(t,e,r){return e||(e=t+r),e.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/),e}(e,r,".png"));return new Promise((r,s)=>{(function(t){return t.data=new Image,t.crossOrigin&&(t.data.crossOrigin=t.crossOrigin),new Promise((e,r)=>{t.data.onload=()=>{t.data.onload&&(t.data.onload=null,t.data.onerror=null,e(t))},t.data.onerror=e=>{t.data.onload&&(t.data.onload=null,t.data.onerror=null,t.error=e,r(t))},t.data.src=t.url,t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,e(t))})})(i).then(i=>{r(t.textures.add(e,i.data))}).catch(t=>{s(null)})})}function O(t,e,r=32,i=32,s=2,n=2){const o=function(t,e){const r=document.createElement("canvas");return r.width=t,r.height=e,r.getContext("2d")}(r,i),h=r/s,a=i/n;o.fillStyle=t,o.fillRect(0,0,r,i),o.fillStyle=e;for(let t=0;t<n;t++)for(let e=t%2;e<s;e+=2)o.fillRect(e*h,t*a,h,a);return new y("",o.canvas)}class X extends z{constructor(t){super(t);const e=O("#ff0000","#00ff00",256,256,8,8);this.game.textures.add("grid",e),this.world.addChild(new U(this,400,300,"grid"))}}class N extends z{constructor(t){super(t,"Bob"),M(t,"logo","assets/logo.png").then(()=>{this.world.addChild(new U(this,400,300,"logo"))})}}new D({width:800,height:600,backgroundColor:51,parent:"gameParent",scene:[X,N]})}();
//# sourceMappingURL=index.min.js.map
